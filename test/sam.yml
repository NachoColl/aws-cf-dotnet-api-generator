AWSTemplateFormatVersion: '2010-09-09'
Transform: 'AWS::Serverless-2016-10-31'
Description: My API Base Resources.

Parameters:

  S3Bucket:
    Type: String

  PackageBaseFileName:
    Type: String
    Description: The package file name (e.g. 'mySourceCode')
  
  PackageVersion:
    Type: String 
    Description: The package file version (e.g. '78')

Globals:
  Function:
    Runtime: dotnetcore2.0
    CodeUri: 
      Bucket: !Ref S3Bucket
      Key: !Sub "api/${PackageBaseFileName}-${PackageVersion}.zip"     
    Timeout: 60
    Tags: 
      appcode: myapi
          
Resources:

  #################################################################################
  # API Gateway definition                                                        #
  #################################################################################

  myAPI: 
    Type: "AWS::ApiGateway::RestApi"
    Properties:
      Description: "My API"
      Name: "my-api"
      EndpointConfiguration:
        Types:
        - REGIONAL

  # do not delete this mark
  # deploy will use it to inject cloudformation resources.

  # @INJECT

Outputs:

  myAPIId:
    Description: API Gateway ID
    Value: !Ref myAPI
    Export:
      Name: !Sub "${AWS::StackName}-ApiGatewayId"

  myAPIRootResourceId:
    Description: API Gateway ID
    Value: !GetAtt myAPI.RootResourceId
    Export:
      Name: !Sub "${AWS::StackName}-ApiGatewayRootResourceId"
